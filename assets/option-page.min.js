!function(e,t,o){"use strict";function a(e){var t=c.val().split("?",1);c.val(t[0]+"?page=agm_settings#top#"+e)}function n(e){var t=v.styles.filter(function(t){return t.id==e});return t.length?t[0].style:[]}function l(e){return t.querySelector("#"+e)||t.getElementById(e)}function r(){var a=Math.max(t.documentElement.clientWidth,e.innerWidth||0);d=new google.maps.LatLng(parseFloat(v.map.lat),parseFloat(v.map.lng)),u={draggable:a>480||!i(),center:d,streetViewControl:!0,zoom:parseInt(v.map.zoom),mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_LEFT},styles:n(v.map.style),fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}},p=new google.maps.Map(f,u);var r=o("#agm-lat"),s=o("#agm-lng"),g=o("#agm-zoom"),c=o("#agm-zoom-val"),m=new google.maps.Marker({draggable:!0,position:d,optimized:!1,map:p,title:"Current Location",icon:v.marker.file||v.marker.color||""});google.maps.event.addListener(p,"rightclick",function(e){r.val(e.latLng.lat()),s.val(e.latLng.lng()),m.setTitle("Selected Location"),m.setPosition(e.latLng)}),google.maps.event.addListener(m,"dragend",function(e){r.val(e.latLng.lat()),s.val(e.latLng.lng())}),google.maps.event.addListener(p,"zoom_changed",function(){g.val(p.getZoom()),c.html(p.getZoom())}),google.maps.event.addListener(p,"center_changed",function(){var e=p.getCenter();r.val(e.lat()),s.val(e.lng())}),google.maps.event.addListener(p,"idle",function(){google.maps.event.trigger(p,"resize")});var h;google.maps.event.addDomListener(e,"resize",function(){h&&clearTimeout(h),h=e.setTimeout(function(){p.setCenter(d)},300)}),g.on("input.agm click.agm",function(){c.html(this.value),p.setZoom(parseInt(g.val()))});var y=l("agm-search"),C=new google.maps.places.Autocomplete(y);p.controls[google.maps.ControlPosition.TOP_LEFT].push(y),google.maps.event.addListener(C,"place_changed",function(){var e=C.getPlace();e.geometry&&(p.panTo(e.geometry.location),m.setPosition(e.geometry.location),p.setZoom(15),m.setTitle(e.formatted_address))})}function i(){return"ontouchstart"in e||navigator.maxTouchPoints}var s=e.location.hash.replace("#top#",""),g=o("h2#wpt-tabs"),c=o("form#agm-form").find('input:hidden[name="_wp_http_referer"]'),m=o("section.tab-content");""!==s&&0!=o("#"+s).length||(s=m.attr("id")),o("#"+s).addClass("active"),o("#"+s+"-tab").addClass("nav-tab-active"),a(s),g.find("a.nav-tab").on("click.agm",function(e){e.stopPropagation(),g.find("a.nav-tab").removeClass("nav-tab-active"),m.removeClass("active");var t=o(this).attr("id").replace("-tab","");o("#"+t).addClass("active"),o(this).addClass("nav-tab-active"),a(t)});var p,d,v=e._agmOpt,u={},f=l("agm-canvas");"object"==typeof google&&google.maps?google.maps.event.addDomListener(e,"load",r):f.innerHTML='<h4 class="map-not-loaded" style="text-align: center;color: #ba060b">Failed to load Google Map.<br>Refresh this page and try again.<br>Check your internet connection as well.</h4>',o("#wpt-loc-tab").one("click.agm",function(){try{google.maps.event.trigger(p,"resize"),p.setCenter(d)}catch(e){console.error("Google map not loaded yet")}}),o("#agm-map-style").on("change.agm",function(e){e.preventDefault();try{p.setOptions({styles:n(o(this).val())})}catch(e){console.error("Google map not loaded yet")}}),o("#agm-search").on("keydown",function(e){return 13==e.keyCode||13==e.which?(e.preventDefault(),e.stopPropagation(),!1):void 0});try{o("#agm-border-color").wpColorPicker()}catch(h){console.error("WP Color Picker not loaded")}var y;o("#agm-marker-file").on("click.agm",function(e){e.preventDefault();var t=o(this);return y?void y.open():(y=wp.media({title:"Choose Marker",button:{text:"Choose Image"},library:{type:"image"},multiple:!1}),y.on("select",function(){t.prev("input").val(y.state().get("selection").first().toJSON().url)}),void y.open())})}(window,document,jQuery);